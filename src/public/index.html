<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/png" href="favicon.svg" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
			rel="stylesheet"
		/>
		<link rel="stylesheet" href="style.css" />
		<title>Echo AI - Chatbot</title>
	</head>
	<body>
		<main>
			<div class="messages-container"></div>
			<form>
				<textarea
					name="message"
					id="message"
					placeholder="Type a message"
					autocomplete="off"
					rows="1"
				></textarea>
			</form>
		</main>
	</body>
	<script src="/socket.io/socket.io.js"></script>
	<script>
		const socket = io();
		const form = document.querySelector('form');
		const textarea = document.querySelector('textarea');
		const messages = document.querySelector('.messages-container');

		socket.on('message', (msg) => {
			addMessage(msg);
		});

		function addMessage(msg, isUser = false) {
			const p = document.createElement('p');
			p.style = 'align-self: ' + (isUser ? 'end' : 'start');
			p.textContent = msg;
			messages.appendChild(p);
			window.scrollTo(0, textarea.offsetTop + textarea.offsetHeight);
		}

		form.addEventListener('submit', (e) => {
			e.preventDefault();

			addMessage(textarea.value, true);
			socket.emit('message', textarea.value);

			form.reset();
		});

		textarea.addEventListener('keypress', (e) => {
			if (e.key === 'Enter' && !e.shiftKey) {
				e.preventDefault();
				if (textarea.value.length > 0) {
					form.dispatchEvent(new Event('submit'));
				}
			}
		});
	</script>
</html>
